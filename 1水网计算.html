<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
    <title>å–·å¤´è®¡ç®—å™¨ï¼ˆæµ®çª—æ·»åŠ ç‰ˆï¼‰</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{padding:15px;font-family:Arial;font-size:14px;background:#f5f5f5;}
        .box{max-width:600px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 12px rgba(0,0,0,0.15);position:relative;}
        h1{text-align:center;color:#2c3e50;font-size:18px;margin-bottom:25px;font-weight:bold;}
        .inp-group{margin-bottom:18px;}
        .inp-group label{display:block;margin-bottom:6px;color:#34495e;font-weight:500;}
        .inp-group input{width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:15px;outline:none;}
        .inp-group select{width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:15px;outline:none;background:#fff;}
        .inp-group input:focus{border-color:#3498db;}
        .btn{width:100%;padding:13px;background:#27ae60;color:#fff;border:none;border-radius:6px;font-size:16px;font-weight:bold;cursor:pointer;margin:10px 0 25px;}
        .btn:active{background:#219a52;}
        .result{display:none;}
        .title{font-size:16px;color:#2c3e50;font-weight:bold;margin:18px 0 12px;padding-bottom:6px;border-bottom:2px solid #ecf0f1;}
        .param p{line-height:2.2;color:#34495e;margin:6px 0;}
        
        table{width:100%;border-collapse:collapse;margin:10px 0;table-layout:fixed;}
th,td{border:1px solid #ddd;padding:8px;text-align:center; color:#333;} /* å…¨å±€å±…ä¸­+å­—ä½“é¢œè‰²ç»Ÿä¸€ */
th{background:#ecf0f1;color:#2c3e50;font-weight:bold;}

/* åˆ—å®½ç»Ÿä¸€ */
#materialTable th:nth-child(1),
#materialTable td:nth-child(1) {width: 80px;}
#materialTable th:nth-child(2),
#materialTable td:nth-child(2) {width: 180px;}
#materialTable th:nth-child(3),
#materialTable td:nth-child(3) {width: 60px;}
#materialTable th:nth-child(4),
#materialTable td:nth-child(4) {width: 80px;}
#materialTable th:nth-child(5),
#materialTable td:nth-child(5) {width: 80px;}
#materialTable th:nth-child(6),
#materialTable td:nth-child(6) {width: 80px;}

/* æ•°é‡è¾“å…¥æ¡†ç»Ÿä¸€ */
.qty-input, .custom-qty {
    width:60px !important;
    padding:3px !important;
    font-size:12px !important;
    text-align:center !important;
    border:1px solid #ddd !important;
    border-radius:4px !important;
}

/* é€‰é…ä»¶è¡Œæ ·å¼ç»Ÿä¸€ï¼ˆä¸å…¶ä»–è¡Œä¸€è‡´ï¼‰ */
tr td {
    background:none !important; /* å»æ‰é€‰é…ä»¶è¡Œçš„èƒŒæ™¯è‰²å·®å¼‚ */
}



        .total{background:#f8f9fa;font-weight:bold;color:#e74c3c;}
        .discount-row{background:#fdf2f8;color:#9f7aea;font-weight:bold;}
        .final-total{background:#e8f5e9;color:#27ae60;font-weight:bold;font-size:15px;}
        .tips{font-size:12px;color:#7f8c8d;margin-top:10px;text-align:center;}
        .qty-input{width:60px;padding:4px;text-align:center;border:1px solid #ddd;border-radius:4px;}
        .qty-input:disabled{background:#f5f5f5;cursor:not-allowed;}
        .custom-item{display:none;}
        .show-custom .custom-item{display:table-row;}
        .custom-item.show-custom-item{display:table-row !important;}
        .hide-item.show-hide-item{display:table-row !important;}
        .hide-item{display:none;}
        .hidden-visually{visibility:hidden;}
        .dili{background-color: #e8f5e9;}
        .ditou{background-color: #e3f2fd;}
        .beiyong{background-color: #fff3e0;}
        .custom-item.dili{background-color: #f2f9f2;}
        .custom-item.ditou{background-color: #f2f7fd;}
        .custom-item.beiyong{background-color: #fef9f2;}
        .switch-container{display:flex;justify-content:space-between;align-items:center;margin:15px 0;padding:0 10px;flex-wrap:wrap;gap:10px;}
        .switch-wrap{display:flex;align-items:center;gap:8px;cursor:pointer;}
        .switch{position:relative;width:50px;height:26px;border-radius:13px;background:#ddd;cursor:pointer;transition:background 0.3s;}
        .switch::after{content:'';position:absolute;width:22px;height:22px;border-radius:50%;background:#fff;top:2px;left:2px;transition:left 0.3s;}
        .switch.active{background:#3498db;}
        .switch.active::after{left:26px;}
        .switch-text{font-size:13px;color:#34495e;font-weight:500;white-space:nowrap;}
        .gun-switch-wrap{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:20px;padding:10px;background:#f8f9fa;border-radius:8px;flex-wrap:wrap;}
        .history-btn-group{position:absolute;top:20px;right:20px;display:flex;gap:8px;}
        .history-small-btn{width:40px;height:40px;border-radius:50%;border:none;background:#f1f5f9;color:#2c3e50;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background 0.2s;}
        .history-small-btn:hover{background:#e1eaf1;}
        .history-small-btn.clear-btn{background:#fef2f2;color:#dc2626;}
        .history-panel{margin:15px 0;padding:10px;background:#f8fafc;border-radius:6px;max-height:150px;overflow-y:auto;display:none;}
        .history-panel.show{display:block;}
        .history-item{padding:8px;border-bottom:1px solid #e2e8f0;cursor:pointer;transition:background 0.2s;}
        .history-item:last-child{border-bottom:none;}
        .history-item:hover{background:#e6f7ff;}
        .history-item span{display:inline-block;margin:0 4px;color:#34495e;font-size:13px;}
        .history-time{color:#7f8c8d;font-size:12px;}
        .modal-mask{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:999;display:none;}
        .modal-box{background:#fff;padding:25px;border-radius:10px;width:80%;max-width:300px;text-align:center;}
        .modal-title{font-size:16px;color:#2c3e50;font-weight:bold;margin-bottom:20px;}
        .modal-btn-group{display:flex;gap:10px;}
        .modal-btn{flex:1;padding:10px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;}
        .modal-confirm{background:#dc2626;color:#fff;}
        .modal-cancel{background:#f1f5f9;color:#2c3e50;}
        .discount-container{margin:15px 0;padding:15px;background:#faf0f5;border-radius:8px;}
        .discount-title{font-size:15px;color:#2c3e50;font-weight:bold;margin-bottom:10px;}
        .discount-input-group{display:flex;gap:10px;margin-bottom:10px;}
        .discount-input-group input{flex:1;}
        .discount-btn{width:100%;padding:10px;background:#9f7aea;color:#fff;border:none;border-radius:6px;font-size:14px;font-weight:bold;cursor:pointer;}
        .discount-btn:active{background:#805ad5;}
        @media screen and (max-width: 480px) {
            th,td{padding:4px;font-size:12px;}
            .qty-input{width:40px;padding:2px;}
            .discount-input-group{flex-direction:column;}
        }
        /* æ•´å¥—æ‹†åˆ†ç›¸å…³æ ·å¼ */
        .package-row{cursor:pointer;}
        .package-icon{margin-left:5px;transition:transform 0.3s;}
        .package-icon.expanded{transform:rotate(180deg);}
        .package-item{display:none;background-color:#f9f9f9;}
        .package-item td:first-child{text-align:left;padding-left:20px;}
        .price-input{width:60px;padding:4px;border:1px solid #ddd;border-radius:4px;text-align:center;}
        /* è‡ªå®šä¹‰æ–°å¢ç‰©æ–™æ ·å¼ */
        .delete-custom-item{background:#ff4444;color:white;border:none;padding:4px 8px;border-radius:3px;cursor:pointer;font-size:12px;}
        .custom-name,.custom-unit,.custom-price,.custom-qty{padding:4px;border:1px solid #ddd;border-radius:4px;}
        .add-item-row td{border:none; padding:10px 0;}
        /* æµ®çª—æ ·å¼ */
        .parts-modal-mask{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:1000;display:none;align-items:center;justify-content:center;}
        .parts-modal{background:#fff;width:90%;max-width:600px;border-radius:10px;padding:20px;max-height:80vh;overflow-y:auto;}
        .parts-modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;border-bottom:1px solid #eee;padding-bottom:10px;}
        .parts-modal-title{font-size:16px;font-weight:bold;color:#2c3e50;}
        .parts-modal-close{font-size:20px;cursor:pointer;color:#7f8c8d;}
        .parts-grid{display:grid;grid-template-columns:1fr 3fr;gap:10px;}
        .parts-category{background:#f8f9fa;padding:10px;border-radius:6px;font-weight:bold;color:#2c3e50;text-align:center;}
        .parts-list{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;}
        .parts-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border:1px solid #eee;border-radius:6px;background:#fafafa;}
        .parts-item-name{font-size:13px;color:#34495e;line-height:1.4;}
        .parts-item-name small{font-size:11px;color:#7f8c8d;}
        .parts-item-add{width:24px;height:24px;border-radius:50%;background:#27ae60;color:#fff;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;line-height:1;}

    </style>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
    <div class="box">
        <h1>å–·å¤´è®¡ç®—å™¨ï¼ˆæµ®çª—æ·»åŠ ç‰ˆï¼‰</h1>
        <div class="history-btn-group">
            <button class="history-small-btn" id="toggleHistoryBtn">ğŸ“œ</button>
            <button class="history-small-btn clear-btn" id="clearHistoryBtn">ğŸ—‘ï¸</button>
        </div>
        
        <div class="inp-group">
            <label>å–·å¤´ç±»å‹</label>
            <select id="nozzleType">
                <option value="four">å››å˜´å–·å¤´</option>
                <option value="sand">é˜²æ²™å–·å¤´</option>
                <option value="horn">ç¾Šè§’å–·å¤´</option>
                <option value="custom">è‡ªå®šä¹‰å–·å¤´</option>
            </select>
        </div>
        
        <div class="gun-switch-wrap">
            <div class="switch-wrap" data-size="1.2">
                <span class="switch-text">1.2ç±³å–·å¤´</span>
                <div class="switch active" id="gun12Switch"></div>
            </div>
            <div class="switch-wrap" data-size="1.5">
                <span class="switch-text">1.5ç±³å–·å¤´</span>
                <div class="switch" id="gun15Switch"></div>
            </div>
        </div>
        
        <div class="inp-group">
            <label>åœ°å—é•¿åº¦(ç±³)</label>
            <input type="number" id="plotLength" placeholder="ä¾‹ï¼š200" min="1" value="200">
        </div>
        <div class="inp-group">
            <label>åœ°å—å®½åº¦(ç±³)</label>
            <input type="number" id="plotWidth" placeholder="ä¾‹ï¼š48" min="1" value="48">
        </div>
        <div class="inp-group">
            <label>å–·å¤´é—´è·(ç±³)</label>
            <input type="number" id="nozzleDiameter" placeholder="å››å˜´16/é˜²æ²™10" min="8" value="16">
        </div>
        <div class="inp-group">
            <label>åˆ—é—´è·(ç±³)</label>
            <input type="number" id="colGap" placeholder="å››å˜´16/é˜²æ²™10" min="5" value="16">
        </div>
        
        <div class="history-panel" id="historyPanel"></div>
        <button class="btn" id="calcBtn">è®¡ç®—</button>
        
        <div class="result" id="result">
            <div class="title">ä¸€ã€æ ¸å¿ƒå‚æ•°</div>
            <div class="param" id="param"></div>
            <div class="title">äºŒã€ç‰©æ–™æ¸…å•</div>
           <div class="discount-container">
    <div class="discount-title">ğŸ’° è¾“å…¥ä¼˜æƒ åé‡‘é¢</div>
    <div class="discount-input-group">
        <input type="number" id="discountAmount" placeholder="è¾“å…¥ä¼˜æƒ åé‡‘é¢ï¼ˆå…ƒï¼‰" min="0" step="0.1" value="0">
    </div>
    <button class="discount-btn" id="applyDiscountBtn">åº”ç”¨å‡å…</button>
    <!-- æœ€ç»ˆä¼˜åŒ–ï¼šä¿ç•™ä¸­é—´å‚ç›´çº¿+ç´§å‡‘å¸ƒå±€+æ·¡è‰²å°å­—ä½“ -->
    <div style="margin-top: 6px; font-size: 11px; color: #a0aec0;">
        <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
            <p style="margin: 0; text-align: center;">æœªå‡å…æ€»ä»·ï¼š<span id="showOriginalTotal">0.0</span>å…ƒ</p>
            <div style="width: 1px; height: 14px; background-color: #cbd5e0;"></div>
            <p style="margin: 0; text-align: center;">è‡ªåŠ¨å‡å…ï¼š<span id="showAutoDiscount">0.0</span>å…ƒ</p>
        </div>
    </div>
</div>


            <table id="materialTable">
    <tr>
    <th>åˆ†ç±»</th>
    <th>é…ä»¶åç§°</th>
    <th>è§„æ ¼</th>
    <th>å•ä»·(å…ƒ)</th>
    <th id="quantityHeader" style="cursor: pointer; color: #2c3e50; font-weight: bold;" onclick="toggleQtyLock()">
        æ•°é‡
        <span id="lockStatus"></span>
    </th>
    <th>åˆè®¡(å…ƒ)</th>
</tr>
                <!-- å››å˜´å–·æªæ•´å¥—ï¼ˆ1.2ç±³/1.5ç±³ï¼‰ -->
                <tr class="dili package-row" id="four12PackageTr" data-package="four12">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>1.2ç±³å››å˜´å–·æªæ•´å¥— <span class="package-icon">â–¼</span></td>
                    <td>å¥—</td>
                    <td>20</td>
                    <td><input type="number" class="qty-input package-qty" oninput="updatePackageItems('four12', this.value);calcTotal(false)" id="q_four12" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_four12">0.0</td>
                </tr>
                <tr class="package-item" data-package="four12">
                    <td></td>
                    <td>å››å˜´å–·å¤´</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="four12" data-item="nozzle" value="7" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_four12_nozzle" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_four12_nozzle">0.0</td>
                </tr>
                <tr class="package-item" data-package="four12">
                    <td></td>
                    <td>1.2ç±³ç«‹æ†</td>
                    <td>æ ¹</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="four12" data-item="pole" value="7" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_four12_pole" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_four12_pole">0.0</td>
                </tr>
                <tr class="package-item" data-package="four12">
                    <td></td>
                    <td>90å…¬åˆ†åœ°æ’</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="four12" data-item="groundPlug" value="8" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_four12_groundPlug" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_four12_groundPlug">0.0</td>
                </tr>
                <tr class="package-item" data-package="four12">
                    <td></td>
                    <td>2.5å¯¸è½¬1å¯¸ä¸‰é€š</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="four12" data-item="tee" value="2" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_four12_tee" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_four12_tee">0.0</td>
                </tr>
                <tr class="dili package-row" id="four15PackageTr" data-package="four15">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>1.5ç±³å››å˜´å–·æªæ•´å¥— <span class="package-icon">â–¼</span></td>
                    <td>å¥—</td>
                    <td>22</td>
                    <td><input type="number" class="qty-input package-qty" oninput="updatePackageItems('four15', this.value);calcTotal(false)" id="q_four15" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_four15">0.0</td>
                </tr>
                <tr class="package-item" data-package="four15">
                    <td></td>
                    <td>å››å˜´å–·å¤´</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="four15" data-item="nozzle" value="7" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_four15_nozzle" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_four15_nozzle">0.0</td>
                </tr>
                <tr class="package-item" data-package="four15">
                    <td></td>
                    <td>1.5ç±³ç«‹æ†</td>
                    <td>æ ¹</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="four15" data-item="pole" value="8" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_four15_pole" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_four15_pole">0.0</td>
                </tr>
                <tr class="package-item" data-package="four15">
                    <td></td>
                    <td>90å…¬åˆ†åœ°æ’</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="four15" data-item="groundPlug" value="8" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_four15_groundPlug" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_four15_groundPlug">0.0</td>
                </tr>
                <tr class="package-item" data-package="four15">
                    <td></td>
                    <td>2.5å¯¸è½¬1å¯¸ä¸‰é€š</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="four15" data-item="tee" value="2" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_four15_tee" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_four15_tee">0.0</td>
                </tr>
                <!-- é˜²æ²™å–·æªæ•´å¥—ï¼ˆ1.2ç±³/1.5ç±³ï¼‰ -->
                <tr class="dili package-row" id="sand12PackageTr" data-package="sand12">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>1.2ç±³é˜²æ²™å–·æªæ•´å¥— <span class="package-icon">â–¼</span></td>
                    <td>å¥—</td>
                    <td>18</td>
                    <td><input type="number" class="qty-input package-qty" oninput="updatePackageItems('sand12', this.value);calcTotal(false)" id="q_sand12" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_sand12">0.0</td>
                </tr>
                <tr class="package-item" data-package="sand12">
                    <td></td>
                    <td>é˜²æ²™å–·å¤´</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="sand12" data-item="nozzle" value="5" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_sand12_nozzle" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_sand12_nozzle">0.0</td>
                </tr>
                <tr class="package-item" data-package="sand12">
                    <td></td>
                    <td>1.2ç±³ç«‹æ†</td>
                    <td>æ ¹</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="sand12" data-item="pole" value="7" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_sand12_pole" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_sand12_pole">0.0</td>
                </tr>
                <tr class="package-item" data-package="sand12">
                    <td></td>
                    <td>90å…¬åˆ†åœ°æ’</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="sand12" data-item="groundPlug" value="8" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_sand12_groundPlug" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_sand12_groundPlug">0.0</td>
                </tr>
                <tr class="package-item" data-package="sand12">
                    <td></td>
                    <td>2.5å¯¸è½¬1å¯¸ä¸‰é€š</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="sand12" data-item="tee" value="2" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_sand12_tee" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_sand12_tee">0.0</td>
                </tr>
                <tr class="dili package-row" id="sand15PackageTr" data-package="sand15">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>1.5ç±³é˜²æ²™å–·æªæ•´å¥— <span class="package-icon">â–¼</span></td>
                    <td>å¥—</td>
                    <td>20</td>
                    <td><input type="number" class="qty-input package-qty" oninput="updatePackageItems('sand15', this.value);calcTotal(false)" id="q_sand15" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_sand15">0.0</td>
                </tr>
                <tr class="package-item" data-package="sand15">
                    <td></td>
                    <td>é˜²æ²™å–·å¤´</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="sand15" data-item="nozzle" value="5" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_sand15_nozzle" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_sand15_nozzle">0.0</td>
                </tr>
                <tr class="package-item" data-package="sand15">
                    <td></td>
                    <td>1.5ç±³ç«‹æ†</td>
                    <td>æ ¹</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="sand15" data-item="pole" value="8" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_sand15_pole" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_sand15_pole">0.0</td>
                </tr>
                <tr class="package-item" data-package="sand15">
                    <td></td>
                    <td>90å…¬åˆ†åœ°æ’</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="sand15" data-item="groundPlug" value="8" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_sand15_groundPlug" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_sand15_groundPlug">0.0</td>
                </tr>
                <tr class="package-item" data-package="sand15">
                    <td></td>
                    <td>2.5å¯¸è½¬1å¯¸ä¸‰é€š</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="sand15" data-item="tee" value="2" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_sand15_tee" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_sand15_tee">0.0</td>
                </tr>
                <!-- ç¾Šè§’å–·æªæ•´å¥—ï¼ˆ1.2ç±³/1.5ç±³ï¼‰ -->
                <tr class="dili package-row" id="horn12PackageTr" data-package="horn12">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>1.2ç±³ç¾Šè§’å–·æªæ•´å¥— <span class="package-icon">â–¼</span></td>
                    <td>å¥—</td>
                    <td>25</td>
                    <td><input type="number" class="qty-input package-qty" oninput="updatePackageItems('horn12', this.value);calcTotal(false)" id="q_horn12" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_horn12">0.0</td>
                </tr>
                <tr class="package-item" data-package="horn12">
                    <td></td>
                    <td>ç¾Šè§’å–·å¤´</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="horn12" data-item="nozzle" value="12" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_horn12_nozzle" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_horn12_nozzle">0.0</td>
                </tr>
                <tr class="package-item" data-package="horn12">
                    <td></td>
                    <td>1.2ç±³ç«‹æ†</td>
                    <td>æ ¹</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="horn12" data-item="pole" value="7" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_horn12_pole" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_horn12_pole">0.0</td>
                </tr>
                <tr class="package-item" data-package="horn12">
                    <td></td>
                    <td>90å…¬åˆ†åœ°æ’</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="horn12" data-item="groundPlug" value="8" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_horn12_groundPlug" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_horn12_groundPlug">0.0</td>
                </tr>
                <tr class="package-item" data-package="horn12">
                    <td></td>
                    <td>2.5å¯¸è½¬1å¯¸ä¸‰é€š</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="horn12" data-item="tee" value="2" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_horn12_tee" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_horn12_tee">0.0</td>
                </tr>
                <tr class="dili package-row" id="horn15PackageTr" data-package="horn15">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>1.5ç±³ç¾Šè§’å–·æªæ•´å¥— <span class="package-icon">â–¼</span></td>
                    <td>å¥—</td>
                    <td>27</td>
                    <td><input type="number" class="qty-input package-qty" oninput="updatePackageItems('horn15', this.value);calcTotal(false)" id="q_horn15" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_horn15">0.0</td>
                </tr>
                <tr class="package-item" data-package="horn15">
                    <td></td>
                    <td>ç¾Šè§’å–·å¤´</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="horn15" data-item="nozzle" value="12" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_horn15_nozzle" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_horn15_nozzle">0.0</td>
                </tr>
                <tr class="package-item" data-package="horn15">
                    <td></td>
                    <td>1.5ç±³ç«‹æ†</td>
                    <td>æ ¹</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="horn15" data-item="pole" value="8" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_horn15_pole" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_horn15_pole">0.0</td>
                </tr>
                <tr class="package-item" data-package="horn15">
                    <td></td>
                    <td>90å…¬åˆ†åœ°æ’</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="horn15" data-item="groundPlug" value="8" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_horn15_groundPlug" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_horn15_groundPlug">0.0</td>
                </tr>
                <tr class="package-item" data-package="horn15">
                    <td></td>
                    <td>2.5å¯¸è½¬1å¯¸ä¸‰é€š</td>
                    <td>ä¸ª</td>
                    <td><input type="number" class="price-input package-price" oninput="calcTotal(false)" data-package="horn15" data-item="tee" value="2" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td><input type="number" class="qty-input package-item-qty" oninput="calcTotal(false)" id="q_horn15_tee" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_horn15_tee">0.0</td>
                </tr>
                <!-- åŸæœ‰æ ¸å¿ƒç‰©æ–™ -->
                <tr class="dili hide-item" id="pipe8mTr">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>2.5å¯¸æ”¯ç®¡æ•´å¥—(8ç±³)</td>
                    <td>ç›˜</td>
                    <td>26</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q2" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s2">0.0</td>
                </tr>
                <tr class="dili hide-item" id="pipe16mTr">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>2.5å¯¸æ”¯ç®¡æ•´å¥—(16ç±³)</td>
                    <td>ç›˜</td>
                    <td>39</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q3" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s3">0.0</td>
                </tr>
                <tr class="dili hide-item" id="pipe5mTr">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>2.5å¯¸æ”¯ç®¡æ•´å¥—(5ç±³)</td>
                    <td>ç›˜</td>
                    <td>20</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q_s5" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_s5">0.0</td>
                </tr>
                <tr class="dili hide-item" id="pipe10mTr">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>2.5å¯¸æ”¯ç®¡æ•´å¥—(10ç±³)</td>
                    <td>ç›˜</td>
                    <td>27</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q_s10" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_s10">0.0</td>
                </tr>
                <tr class="dili" id="rawTapeTr">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>ç”Ÿæ–™å¸¦</td>
                    <td>å·</td>
                    <td>0.8</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q4" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s4">0.0</td>
                </tr>
                <tr class="dili" id="rubberPlugTr">
                    <td>åœ°é‡Œå¿…å¤‡</td>
                    <td>2.5å¯¸å µå¤´(èƒ¶)</td>
                    <td>ä¸ª</td>
                    <td>1.5</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q5" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s5">0.0</td>
                </tr>
                <tr class="ditou hide-item" id="main16mTr">
                    <td>åœ°å¤´å¿…å¤‡</td>
                    <td>3å¯¸16ç±³ä¸»ç®¡å¥—è£…</td>
                    <td>ç›˜</td>
                    <td>62</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q8" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s8">0.0</td>
                </tr>
                <tr class="ditou hide-item" id="main10mTr">
                    <td>åœ°å¤´å¿…å¤‡</td>
                    <td>3å¯¸ä¸»ç®¡10ç±³</td>
                    <td>ç›˜</td>
                    <td>43</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q_s3" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s_s3">0.0</td>
                </tr>
                <tr class="ditou hide-item" id="threeWayTr">
                    <td>åœ°å¤´å¿…å¤‡</td>
                    <td>3å¯¸è½¬2.5å¯¸ä¸‰é€š1é˜€æ•´å¥—</td>
                    <td>å¥—</td>
                    <td>39</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q6" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s6">0.0</td>
                </tr>
                <tr class="ditou hide-item" id="fourWayTr">
                    <td>åœ°å¤´å¿…å¤‡</td>
                    <td>3å¯¸è½¬2.5å¯¸å››é€š2é˜€æ•´å¥—</td>
                    <td>å¥—</td>
                    <td>49</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q7" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s7">0.0</td>
                </tr>
                <tr class="ditou" id="aluminumPlugTr">
                    <td>åœ°å¤´å¿…å¤‡</td>
                    <td>3å¯¸å µå¤´(é“)</td>
                    <td>ä¸ª</td>
                    <td>4.5</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q9" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s9">0.0</td>
                </tr>
                <tr class="beiyong" id="rubberJointTr">
                    <td>å¤‡ç”¨ä»¶</td>
                    <td>2.5å¯¸èƒ¶å¯¹æ¥å¤´</td>
                    <td>å¥—</td>
                    <td>2</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q11" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s11">0.0</td>
                </tr>
                <tr class="beiyong" id="rubberGasketTr">
                    <td>å¤‡ç”¨ä»¶</td>
                    <td>2.5å¯¸å†…å«(å¯†å°åœˆ)</td>
                    <td>ä¸ª</td>
                    <td>0.7</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q12" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s12">0.0</td>
                </tr>
                <tr class="beiyong" id="clampTr">
                    <td>å¤‡ç”¨ä»¶</td>
                    <td>2.5å¯¸å¡ç®</td>
                    <td>ä¸ª</td>
                    <td>0.4</td>
                    <td><input type="number" class="qty-input" oninput="calcTotal(false)" disabled id="q10" min="0" value="0" disabled style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;"></td>
                    <td id="s10">0.0</td>
                </tr>
                <!-- å…ˆæ”¾è‡ªå®šä¹‰ç‰©æ–™å®¹å™¨ -->
                <tbody id="customItemsContainer">
                    <!-- æ–°å¢çš„è‡ªå®šä¹‰è¡Œä¼šåœ¨è¿™é‡Œç”Ÿæˆ -->
                </tbody>
                <!-- æ€»ä»·è¡Œ -->
                <tr class="total" id="originalTotalTr">
                    <td colspan="5">æœªå‡å…æ€»ä»·</td>
                    <td id="originalTotal">0.0</td>
                </tr>
                <tr class="discount-row" id="discountTotalTr">
                    <td colspan="5">ä¼˜æƒ å‡å…</td>
                    <td id="discountTotal">-0.0</td>
                </tr>
                <tr class="final-total" id="finalTotalTr">
                    <td colspan="5">æœ€ç»ˆåº”ä»˜é‡‘é¢</td>
                    <td id="finalTotal">0.0</td>
                </tr>
            </table>
            <div style="text-align: center; margin: 15px 0; display: flex; justify-content: center; gap: 10px;">
                <button id="openPartsModalBtn" class="btn" style="padding: 8px 20px; font-size: 14px; width: auto; background: #3498db;">+ æ·»åŠ é…ä»¶</button>
                <button class="btn" style="background: #9b59b6; padding: 8px 15px; font-size: 13px; width: auto;" id="downloadTableBtn">ğŸ“¥ ä¸‹è½½æ¸…å•æˆªå›¾</button>
            </div>
        </div>
    </div>
    <!-- é…ä»¶æµ®çª—ï¼ˆæ•´åˆæ‰€æœ‰é…ä»¶ï¼ŒæŒ‰ç»Ÿä¸€åˆ†ç±»ï¼‰ -->
    <div class="parts-modal-mask" id="partsModalMask">
        <div class="parts-modal">
            <div class="parts-modal-header">
                <div class="parts-modal-title">é€‰æ‹©é…ä»¶</div>
                <div class="parts-modal-close" id="partsModalClose">Ã—</div>
            </div>
            <div class="parts-grid">
                <!-- å¯¹æ¥å¤´ç±»ï¼ˆæ•´åˆæ‰€æœ‰å¯¹æ¥å¤´ç›¸å…³é…ä»¶ï¼‰ -->
                <div class="parts-category">å¯¹æ¥å¤´ç±»</div>
                <div class="parts-list">
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸å¯¹æ¥å¤´(é“)<br/><small>ï¿¥6/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸å¯¹æ¥å¤´(é“)","spec":"å¥—","price":6}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸å¯¹æ¥å¤´(é“)<br/><small>ï¿¥7/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸å¯¹æ¥å¤´(é“)","spec":"å¥—","price":7}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">4å¯¸å¯¹æ¥å¤´(é“)<br/><small>ï¿¥10/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"4å¯¸å¯¹æ¥å¤´(é“)","spec":"å¥—","price":10}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸å˜3å¯¸å¯¹æ¥å¤´(é“)<br/><small>ï¿¥6/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸å˜3å¯¸å¯¹æ¥å¤´(é“)","spec":"å¥—","price":6}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">4å¯¸å˜3å¯¸å¯¹æ¥å¤´(é“)<br/><small>ï¿¥10/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"4å¯¸å˜3å¯¸å¯¹æ¥å¤´(é“)","spec":"å¥—","price":10}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸å†…å«(å¯†å°åœˆ)<br/><small>ï¿¥0.7/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸å†…å«(å¯†å°åœˆ)","spec":"ä¸ª","price":0.7}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸å†…å«(å¯†å°åœˆ)<br/><small>ï¿¥0.7/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸å†…å«(å¯†å°åœˆ)","spec":"ä¸ª","price":0.7}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸èƒ¶å¯¹æ¥å¤´<br/><small>ï¿¥2/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸èƒ¶å¯¹æ¥å¤´","spec":"å¥—","price":2}'>+</button>
                    </div>
                </div>
                
                <!-- å¡ç®ç±»ï¼ˆæ•´åˆæ‰€æœ‰å¡ç®ç›¸å…³é…ä»¶ï¼‰ -->
                <div class="parts-category">å¡ç®ç±»</div>
                <div class="parts-list">
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸å¡ç®<br/><small>ï¿¥0.4/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸å¡ç®","spec":"ä¸ª","price":0.4}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸å¡ç®<br/><small>ï¿¥0.5/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸å¡ç®","spec":"ä¸ª","price":0.5}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">4å¯¸å¡ç®<br/><small>ï¿¥0.8/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"4å¯¸å¡ç®","spec":"ä¸ª","price":0.8}'>+</button>
                    </div>
                </div>
                
                <!-- ç®¡å­ç±»ï¼ˆæ•´åˆæ‰€æœ‰ç®¡å­ç›¸å…³é…ä»¶ï¼‰ -->
                <div class="parts-category">ç®¡å­ç±»</div>
                <div class="parts-list">
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸æ”¯ç®¡50ç±³(ä¸å¸¦é…ä»¶)<br/><small>ï¿¥100/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸æ”¯ç®¡50ç±³(ä¸å¸¦é…ä»¶)","spec":"ç›˜","price":100}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸ä¸»ç®¡100ç±³(ä¸å¸¦é…ä»¶)<br/><small>ï¿¥200/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸ä¸»ç®¡100ç±³(ä¸å¸¦é…ä»¶)","spec":"ç›˜","price":200}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸ä¸»ç®¡100ç±³(ä¸å¸¦é…ä»¶)<br/><small>ï¿¥270/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸ä¸»ç®¡100ç±³(ä¸å¸¦é…ä»¶)","spec":"ç›˜","price":270}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">4å¯¸ä¸»ç®¡100ç±³(ä¸å¸¦é…ä»¶)<br/><small>ï¿¥340/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"4å¯¸ä¸»ç®¡100ç±³(ä¸å¸¦é…ä»¶)","spec":"ç›˜","price":340}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸ä¸»ç®¡10ç±³<br/><small>ï¿¥43/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸ä¸»ç®¡10ç±³","spec":"ç›˜","price":43}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸æ”¯ç®¡æ•´å¥—(12ç±³)<br/><small>ï¿¥31/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸æ”¯ç®¡æ•´å¥—(12ç±³)","spec":"ç›˜","price":31}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸æ”¯ç®¡æ•´å¥—(8ç±³)<br/><small>ï¿¥26/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸æ”¯ç®¡æ•´å¥—(8ç±³)","spec":"ç›˜","price":26}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸æ”¯ç®¡æ•´å¥—(16ç±³)<br/><small>ï¿¥39/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸æ”¯ç®¡æ•´å¥—(16ç±³)","spec":"ç›˜","price":39}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸æ”¯ç®¡æ•´å¥—(5ç±³)<br/><small>ï¿¥20/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸æ”¯ç®¡æ•´å¥—(5ç±³)","spec":"ç›˜","price":20}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸æ”¯ç®¡æ•´å¥—(10ç±³)<br/><small>ï¿¥27/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸æ”¯ç®¡æ•´å¥—(10ç±³)","spec":"ç›˜","price":27}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸16ç±³ä¸»ç®¡å¥—è£…<br/><small>ï¿¥62/ç›˜</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸16ç±³ä¸»ç®¡å¥—è£…","spec":"ç›˜","price":62}'>+</button>
                    </div>
                </div>
                
                <!-- ä¸‰é€š/å››é€šç±»ï¼ˆæ•´åˆæ‰€æœ‰ä¸‰é€šå››é€šç›¸å…³é…ä»¶ï¼‰ -->
                <div class="parts-category">ä¸‰é€š/å››é€šç±»</div>
                <div class="parts-list">
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸ç­‰å£å¾„ä¸‰é€š1é˜€æ•´å¥—<br/><small>ï¿¥39/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸ç­‰å£å¾„ä¸‰é€š1é˜€æ•´å¥—","spec":"å¥—","price":39}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸ç­‰å£å¾„ä¸‰é€š1é˜€æ•´å¥—<br/><small>ï¿¥39/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸ç­‰å£å¾„ä¸‰é€š1é˜€æ•´å¥—","spec":"å¥—","price":39}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">4å¯¸è½¬2.5å¯¸ä¸‰é€š1é˜€æ•´å¥—<br/><small>ï¿¥39/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"4å¯¸è½¬2.5å¯¸ä¸‰é€š1é˜€æ•´å¥—","spec":"å¥—","price":39}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸ç­‰å£å¾„å››é€š3é˜€æ•´å¥—<br/><small>ï¿¥49/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸ç­‰å£å¾„å››é€š3é˜€æ•´å¥—","spec":"å¥—","price":49}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸ç­‰å£å¾„å››é€š3é˜€æ•´å¥—<br/><small>ï¿¥59/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸ç­‰å£å¾„å››é€š3é˜€æ•´å¥—","spec":"å¥—","price":59}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">4å¯¸è½¬2.5å¯¸å››é€š2é˜€æ•´å¥—<br/><small>ï¿¥44/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"4å¯¸è½¬2.5å¯¸å››é€š2é˜€æ•´å¥—","spec":"å¥—","price":44}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸è½¬2.5å¯¸ä¸‰é€š1é˜€æ•´å¥—<br/><small>ï¿¥39/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸è½¬2.5å¯¸ä¸‰é€š1é˜€æ•´å¥—","
spec":"å¥—","price":39}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸è½¬2.5å¯¸å››é€š2é˜€æ•´å¥—<br/><small>ï¿¥49/å¥—</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸è½¬2.5å¯¸å››é€š2é˜€æ•´å¥—","spec":"å¥—","price":49}'>+</button>
                    </div>
                </div>
                
                <!-- æ§åˆ¶é˜€é—¨ç±»ï¼ˆæ•´åˆæ‰€æœ‰é˜€é—¨ç›¸å…³é…ä»¶ï¼‰ -->
                <div class="parts-category">æ§åˆ¶é˜€é—¨ç±»</div>
                <div class="parts-list">
                    <div class="parts-item">
                        <span class="parts-item-name">æ§åˆ¶é˜€é—¨åŠ çŸ­æ¥<br/><small>ï¿¥5/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"æ§åˆ¶é˜€é—¨åŠ çŸ­æ¥","spec":"ä¸ª","price":5}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">æ§åˆ¶é˜€é—¨+70å…¬åˆ†åŒä¸å¯¹æ¥å¤´<br/><small>ï¿¥7/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"æ§åˆ¶é˜€é—¨+70å…¬åˆ†åŒä¸å¯¹æ¥å¤´","spec":"ä¸ª","price":7}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">æ§åˆ¶é˜€é—¨+1ç±³åŒä¸å¯¹æ¥å¤´<br/><small>ï¿¥8/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"æ§åˆ¶é˜€é—¨+1ç±³åŒä¸å¯¹æ¥å¤´","spec":"ä¸ª","price":8}'>+</button>
                    </div>
                </div>
                
                <!-- å µå¤´ç±»ï¼ˆæ•´åˆæ‰€æœ‰å µå¤´ç›¸å…³é…ä»¶ï¼‰ -->
                <div class="parts-category">å µå¤´ç±»</div>
                <div class="parts-list">
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸å µå¤´(èƒ¶)<br/><small>ï¿¥2/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸å µå¤´(èƒ¶)","spec":"ä¸ª","price":2}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸å µå¤´(é“)<br/><small>ï¿¥4.5/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸å µå¤´(é“)","spec":"ä¸ª","price":4.5}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">2.5å¯¸å µå¤´(èƒ¶)<br/><small>ï¿¥1.5/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"2.5å¯¸å µå¤´(èƒ¶)","spec":"ä¸ª","price":1.5}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">3å¯¸å µå¤´(é“)<br/><small>ï¿¥4.5/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"3å¯¸å µå¤´(é“)","spec":"ä¸ª","price":4.5}'>+</button>
                    </div>
                </div>
                
                <!-- å…¶ä»–é…ä»¶ç±»ï¼ˆæ•´åˆæ‰€æœ‰ä¸“ç”¨é…ä»¶ï¼‰ -->
                <div class="parts-category">å…¶ä»–é…ä»¶ç±»</div>
                <div class="parts-list">
                    <div class="parts-item">
                        <span class="parts-item-name">å–·å¤´åˆ†æ°´é’ˆ<br/><small>ï¿¥1.5/ä¸ª</small></span>
                        <button class="parts-item-add" data-part='{"name":"å–·å¤´åˆ†æ°´é’ˆ","spec":"ä¸ª","price":1.5}'>+</button>
                    </div>
                    <div class="parts-item">
                        <span class="parts-item-name">ç”Ÿæ–™å¸¦<br/><small>ï¿¥0.8/å·</small></span>
                        <button class="parts-item-add" data-part='{"name":"ç”Ÿæ–™å¸¦","spec":"å·","price":0.8}'>+</button>
                    </div>
                </div>
 <div class="parts-category">è‡ªå®šä¹‰é…ä»¶</div>
<div class="parts-list" style="grid-column: span 2; display: block; width: 100%;">
    <div class="custom-input-form" style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
        <!-- æ›¿æ¢æµ®çª—å†…â€œè‡ªå®šä¹‰é…ä»¶â€çš„è¡¨æ ¼éƒ¨åˆ† -->
<table style="width:100%; border-collapse:collapse; font-size:12px;">
    <thead>
    <tr>
        <!-- å…³é”®ä¿®æ”¹ï¼šåŠ å®½åˆ—å®½+å¢å¤§å†…è¾¹è· -->
        <<th style="padding: 8px; text-align:center; border:1px solid #ddd; width: 15%">åˆ†ç±»</</th>
        <<th style="padding: 8px; text-align:center; border:1px solid #ddd; width: 25%;">åç§°</</th>
        <<th style="padding: 8px; text-align:center; border:1px solid #ddd; width: 15%">è§„æ ¼</</th>
        <<th style="padding: 8px; text-align:center; border:1px solid #ddd; width: 15%">å•ä»·</</th>
        <<th style="padding: 8px; text-align:center; border:1px solid #ddd; width: 15%">æ•°é‡</</th>
        <<th style="padding: 8px; text-align:center; border:1px solid #ddd; width: 15%;">æ“ä½œ</</th>
    </tr>
</thead>

    <tbody>
        <tr>
            <!-- åˆ†ç±»å•å…ƒæ ¼ï¼šåŠ å®½è¾“å…¥æ¡† -->
            <td style="padding:8px; text-align:center; border:1px solid #ddd;">
                <select id="custom-category" style="width:100%; padding:4px; font-size:12px;">
                    <option value="é€‰é…ä»¶">é€‰é…ä»¶</option>
                    <option value="èµ é€ä»¶">èµ é€ä»¶</option>
                </select>
            </td>
            <!-- åç§°å•å…ƒæ ¼ï¼šåŠ å®½è¾“å…¥æ¡† -->
            <td style="padding:8px; text-align:center; border:1px solid #ddd;">
                <input type="text" id="custom-name" placeholder="é…ä»¶åç§°" style="width:100%; padding:4px; font-size:12px; box-sizing:border-box;">
            </td>
            <!-- è§„æ ¼å•å…ƒæ ¼ï¼šå¢å¤§æŒ‰é’®é—´è· -->
            <td style="padding:8px; text-align:center; border:1px solid #ddd;">
                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                    <button type="button" class="spec-btn" data-spec="ä¸ª" style="padding: 4px 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 3px; background: #3498db; color: white;">ä¸ª</button>
                    <button type="button" class="spec-btn" data-spec="å¥—" style="padding: 4px 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 3px; background: #f5f5f5;">å¥—</button>
                    <button type="button" class="spec-btn" data-spec="å·" style="padding: 4px 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 3px; background: #f5f5f5;">å·</button>
                    <button type="button" class="spec-btn" data-spec="ç›˜" style="padding: 4px 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 3px; background: #f5f5f5;">ç›˜</button>
                    <button type="button" class="spec-btn" data-spec="å…¶ä»–" style="padding: 4px 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 3px; background: #f5f5f5;">å…¶ä»–</button>
                </div>
                <input type="text" class="custom-spec-input" placeholder="å…¶ä»–è§„æ ¼" style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 3px; margin-top: 6px; display: none;">
            </td>
            <!-- å•ä»·å•å…ƒæ ¼ï¼šåŠ å®½è¾“å…¥æ¡† -->
            <td style="padding:8px; text-align:center; border:1px solid #ddd;">
                <input type="number" id="custom-price" placeholder="0" min="0" step="0.01" style="width:100%; padding:4px; font-size:12px; box-sizing:border-box; text-align:center;">
            </td>
            <!-- æ•°é‡å•å…ƒæ ¼ï¼šåŠ å®½è¾“å…¥æ¡† -->
            <td style="padding:8px; text-align:center; border:1px solid #ddd;">
                <input type="number" id="custom-qty" value="1" min="1" style="width:100%; padding:4px; font-size:12px; box-sizing:border-box; text-align:center;">
            </td>
            <!-- æ“ä½œå•å…ƒæ ¼ï¼šæ”¾å¤§æŒ‰é’® -->
            <td style="padding:8px; text-align:center; border:1px solid #ddd;">
                <button type="button" onclick="addCustomFromTable()" style="padding:6px 12px; background:#27ae60; color:#fff; border:none; border-radius:4px; font-size:12px;">æ·»åŠ </button>

            </td>
        </tr>
    </tbody>
</table>

        <div style="font-size: 11px; color: #7f8c8d; margin-top: 8px; text-align: center;">
            é•¿æŒ‰å·²æ·»åŠ çš„é…ä»¶å¯ä¿®æ”¹å•ä¸ªå­—æ®µ
        </div>
    </div>
</div>
            </div>
        </div>
    </div>
    
    <div class="modal-mask" id="clearModal">
        <div class="modal-box">
            <div class="modal-title">ç¡®è®¤æ¸…ç©ºå†å²è®°å½•ï¼Ÿ</div>
            <p style="color:#7f8c8d;margin-bottom:20px;font-size:14px;">æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ</p>
            <div class="modal-btn-group">
                <button class="modal-btn modal-confirm" id="confirmClearBtn">ç¡®è®¤æ¸…ç©º</button>
                <button class="modal-btn modal-cancel" id="cancelClearBtn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    <script>
        const SYMMETRY_THRESHOLD = 240;
const PRICE_MAP = {
    pipe: { eightM:26, twelveM:31, sixteenM:39, fiveM:20, tenM:27, mainSixteenM:62, mainTenM:43 },
    common: {
        q4:0.8, q5:1.5, q6:39, q7:49, q9:4.5, q10:0.4, q11:2, q12:0.7,
        q13:49, q14:59, q15:7, q16:6, q17:0.7, q21:5, q22:100,
        q23:200, q24:270, q25:340, q26:0.5, q_s5:20, q_s10:27, q_s3:43,
        q30:10, q31:6, q32:10, q33:7, q34:8, q35:2, q36:4.5, q37:0.8
    }
};

// é…ä»¶æ•°æ®ï¼ˆæ•´åˆæ‰€æœ‰é…ä»¶ï¼ŒæŒ‰ç»Ÿä¸€åˆ†ç±»ï¼‰
const PARTS_MAP = {
    joint: [
        {name: "2.5å¯¸å¯¹æ¥å¤´(é“)", spec: "å¥—", price: 6},
        {name: "3å¯¸å¯¹æ¥å¤´(é“)", spec: "å¥—", price: 7},
        {name: "4å¯¸å¯¹æ¥å¤´(é“)", spec: "å¥—", price: 10},
        {name: "2.5å¯¸å˜3å¯¸å¯¹æ¥å¤´(é“)", spec: "å¥—", price: 6},
        {name: "4å¯¸å˜3å¯¸å¯¹æ¥å¤´(é“)", spec: "å¥—", price: 10},
        {name: "2.5å¯¸å†…å«(å¯†å°åœˆ)", spec: "ä¸ª", price: 0.7},
        {name: "3å¯¸å†…å«(å¯†å°åœˆ)", spec: "ä¸ª", price: 0.7},
        {name: "2.5å¯¸èƒ¶å¯¹æ¥å¤´", spec: "å¥—", price: 2}
    ],
    clamp: [
        {name: "2.5å¯¸å¡ç®", spec: "ä¸ª", price: 0.4},
        {name: "3å¯¸å¡ç®", spec: "ä¸ª", price: 0.5},
        {name: "4å¯¸å¡ç®", spec: "ä¸ª", price: 0.8}
    ],
    pipe: [
        {name: "2.5å¯¸æ”¯ç®¡50ç±³(ä¸å¸¦é…ä»¶)", spec: "ç›˜", price: 100},
        {name: "2.5å¯¸ä¸»ç®¡100ç±³(ä¸å¸¦é…ä»¶)", spec: "ç›˜", price: 200},
        {name: "3å¯¸ä¸»ç®¡100ç±³(ä¸å¸¦é…ä»¶)", spec: "ç›˜", price: 270},
        {name: "4å¯¸ä¸»ç®¡100ç±³(ä¸å¸¦é…ä»¶)", spec: "ç›˜", price: 340},
        {name: "3å¯¸ä¸»ç®¡10ç±³", spec: "ç›˜", price: 43},
        {name: "2.5å¯¸æ”¯ç®¡æ•´å¥—(12ç±³)", spec: "ç›˜", price: 31},
        {name: "2.5å¯¸æ”¯ç®¡æ•´å¥—(8ç±³)", spec: "ç›˜", price: 26},
        {name: "2.5å¯¸æ”¯ç®¡æ•´å¥—(16ç±³)", spec: "ç›˜", price: 39},
        {name: "2.5å¯¸æ”¯ç®¡æ•´å¥—(5ç±³)", spec: "ç›˜", price: 20},
        {name: "2.5å¯¸æ”¯ç®¡æ•´å¥—(10ç±³)", spec: "ç›˜", price: 27},
        {name: "3å¯¸16ç±³ä¸»ç®¡å¥—è£…", spec: "ç›˜", price: 62}
    ],
    tee: [
        {name: "2.5å¯¸ç­‰å£å¾„ä¸‰é€š1é˜€æ•´å¥—", spec: "å¥—", price: 39},
        {name: "3å¯¸ç­‰å£å¾„ä¸‰é€š1é˜€æ•´å¥—", spec: "å¥—", price: 39},
        {name: "4å¯¸è½¬2.5å¯¸ä¸‰é€š1é˜€æ•´å¥—", spec: "å¥—", price: 39},
        {name: "2.5å¯¸ç­‰å£å¾„å››é€š3é˜€æ•´å¥—", spec: "å¥—", price: 49},
        {name: "3å¯¸ç­‰å£å¾„å››é€š3é˜€æ•´å¥—", spec: "å¥—", price: 59},
        {name: "4å¯¸è½¬2.5å¯¸å››é€š2é˜€æ•´å¥—", spec: "å¥—", price: 44},
        {name: "3å¯¸è½¬2.5å¯¸ä¸‰é€š1é˜€æ•´å¥—", spec: "å¥—", price: 39},
        {name: "3å¯¸è½¬2.5å¯¸å››é€š2é˜€æ•´å¥—", spec: "å¥—", price: 49}
    ],
    valve: [
        {name: "æ§åˆ¶é˜€é—¨åŠ çŸ­æ¥", spec: "ä¸ª", price: 5},
        {name: "æ§åˆ¶é˜€é—¨+70å…¬åˆ†åŒä¸å¯¹æ¥å¤´", spec: "ä¸ª", price: 7},
        {name: "æ§åˆ¶é˜€é—¨+1ç±³åŒä¸å¯¹æ¥å¤´", spec: "ä¸ª", price: 8}
    ],
    plug: [
        {name: "3å¯¸å µå¤´(èƒ¶)", spec: "ä¸ª", price: 2},
        {name: "2.5å¯¸å µå¤´(é“)", spec: "ä¸ª", price: 4.5},
        {name: "2.5å¯¸å µå¤´(èƒ¶)", spec: "ä¸ª", price: 1.5},
        {name: "3å¯¸å µå¤´(é“)", spec: "ä¸ª", price: 4.5}
    ],
    special: [
        {name: "å–·å¤´åˆ†æ°´é’ˆ", spec: "ä¸ª", price: 1.5},
        {name: "ç”Ÿæ–™å¸¦", spec: "å·", price: 0.8}
    ]
};

let currentNozzleType = "four", currentNozzleSize = "1.2", isEdit = false;
let historyList = JSON.parse(localStorage.getItem('calcHistory')) || []; 
let currentDiscount = 0;
let hasQtyItemIds = [];
let customItemIndex = 1;
let isQtyLocked = true;
const el = {
    nozzleType: document.getElementById('nozzleType'),
    gun12Switch: document.getElementById('gun12Switch'),
    gun15Switch: document.getElementById('gun15Switch'),
    nozzleDiameter: document.getElementById('nozzleDiameter'),
    colGap: document.getElementById('colGap'),
    plotLength: document.getElementById('plotLength'),
    plotWidth: document.getElementById('plotWidth'),
    calcBtn: document.getElementById('calcBtn'),
    result: document.getElementById('result'),
    param: document.getElementById('param'),
    originalTotal: document.getElementById('originalTotal'),
    discountTotal: document.getElementById('discountTotal'),
    finalTotal: document.getElementById('finalTotal'),
    discountAmount: document.getElementById('discountAmount'),
    applyDiscountBtn: document.getElementById('applyDiscountBtn'),
    historyPanel: document.getElementById('historyPanel'),
    toggleHistoryBtn: document.getElementById('toggleHistoryBtn'),
    clearHistoryBtn: document.getElementById('clearHistoryBtn'),
    clearModal: document.getElementById('clearModal'),
    confirmClearBtn: document.getElementById('confirmClearBtn'),
    cancelClearBtn: document.getElementById('cancelClearBtn'),
    threeWayTr: document.getElementById('threeWayTr'),
    fourWayTr: document.getElementById('fourWayTr'),
    pipe8mTr: document.getElementById('pipe8mTr'),
    pipe12mTr: document.getElementById('pipe12mTr'),
    pipe16mTr: document.getElementById('pipe16mTr'),
    pipe5mTr: document.getElementById('pipe5mTr'),
    pipe10mTr: document.getElementById('pipe10mTr'),
    main16mTr: document.getElementById('main16mTr'),
    main10mTr: document.getElementById('main10mTr'),
    customItemsContainer: document.getElementById('customItemsContainer'),
    openPartsModalBtn: document.getElementById('openPartsModalBtn'),
    partsModalMask: document.getElementById('partsModalMask'),
    partsModalClose: document.getElementById('partsModalClose'),
    downloadTableBtn: document.getElementById('downloadTableBtn')
};

const allHideItems = [
    el.pipe8mTr, el.pipe16mTr, el.pipe5mTr, el.pipe10mTr,
    el.main16mTr, el.main10mTr, el.threeWayTr, el.fourWayTr
];

// æ•´å¥—æ‹†åˆ†å±•å¼€/æ”¶èµ·
document.querySelectorAll('.package-row').forEach(row => {
    row.addEventListener('click', function(e) {
        if (!e.target.classList.contains('qty-input')) {
            const packageId = this.dataset.package;
            const icon = this.querySelector('.package-icon');
            const items = document.querySelectorAll(`.package-item[data-package="${packageId}"]`);
            items.forEach(item => item.style.display = item.style.display === 'table-row' ? 'none' : 'table-row');
            icon.classList.toggle('expanded');
        }
    });
});

// æ•´å¥—æ•°é‡è”åŠ¨å•å“æ•°é‡
function updatePackageItems(packageId, qty) {
    const itemQtyInputs = document.querySelectorAll(`.package-item-qty[id^="q_${packageId}_"]`);
    itemQtyInputs.forEach(input => {
        input.value = qty;
    });
}

function checkIsCoreItem(itemId) {
    if (currentNozzleType === "four") {
        return ['pipe8mTr', 'pipe12mTr', 'pipe16mTr', 'main16mTr', 'threeWayTr', 'fourWayTr'].includes(itemId);
    } else if (currentNozzleType === "sand") {
        return ['pipe5mTr', 'pipe10mTr', 'main10mTr', 'threeWayTr', 'fourWayTr'].includes(itemId);
    } else if (currentNozzleType === "horn") {
        return ['pipe8mTr', 'pipe12mTr', 'pipe16mTr', 'main16mTr', 'threeWayTr', 'fourWayTr'].includes(itemId);
    } else if (currentNozzleType === "custom") {
        return ['threeWayTr', 'fourWayTr'].includes(itemId);
    }
    return false;
}

function resetAllItemsDisplay() {
    allHideItems.forEach(item => {
        item.style.display = checkIsCoreItem(item.id) ? 'table-row' : 'none';
    });
    
    hasQtyItemIds.forEach(itemId => {
        const item = document.getElementById(itemId);
        if (item) item.style.display = 'table-row !important';
    });
    document.querySelectorAll('.hide-item .qty-input').forEach(input => input.disabled = true);
}
// æ–°å¢ï¼šå®šä¹‰toggleEditå‡½æ•°ï¼ˆè§£å†³è‡ªå®šä¹‰å–·å¤´åˆ‡æ¢æŠ¥é”™ï¼‰
function toggleEdit() {
    isEdit = !isEdit;
    const packageQtyInputs = document.querySelectorAll('.package-qty');
    packageQtyInputs.forEach(input => {
        input.disabled = !isEdit;
    });
}

function handleNozzleTypeChange() {
    currentNozzleType = el.nozzleType.value;
    switch(currentNozzleType) {
        case "four":
        case "horn":
            el.nozzleDiameter.value = 16;
            el.colGap.value = 16;
            el.nozzleDiameter.disabled = true;
            el.colGap.disabled = true;
            break;
        case "sand":
            el.nozzleDiameter.value = 10;
            el.colGap.value = 10;
            el.nozzleDiameter.disabled = true;
            el.colGap.disabled = true;
            break;
        case "custom":
            el.nozzleDiameter.disabled = false;
            el.colGap.disabled = false;
            if (!isEdit) toggleEdit();
            break;
    }
    resetAllItemsDisplay();
    updatePackageDisplay();
    if (el.result.style.display === "block") calcTotal(true);
}

// åˆ‡æ¢æ•°é‡é”å®šçŠ¶æ€
function toggleQtyLock() {
    isQtyLocked = !isQtyLocked;
    const lockStatus = document.getElementById('lockStatus');
    // å…³é”®ä¿®æ”¹ï¼šåªé€‰æ‹©æ•°é‡è¾“å…¥æ¡†ï¼Œæ’é™¤ä¼˜æƒ é‡‘é¢ã€å•ä»·ç­‰è¾“å…¥æ¡†
    const qtyInputs = document.querySelectorAll('.qty-input, .custom-qty');
    
    lockStatus.textContent = '';
    qtyInputs.forEach(input => {
        input.disabled = isQtyLocked; // ä»…æ•°é‡è¾“å…¥æ¡†ç»Ÿä¸€é”å®š/è§£é”
    });
}


function updatePackageDisplay() {
    const allPackages = ['four12', 'four15', 'sand12', 'sand15', 'horn12', 'horn15'];
    allPackages.forEach(pkg => {
        const pkgRow = document.getElementById(`${pkg}PackageTr`);
        const pkgItems = document.querySelectorAll(`.package-item[data-package="${pkg}"]`);
        const pkgQtyInput = document.getElementById(`q_${pkg}`);
        
        const isFour = pkg.startsWith('four');
        const isSand = pkg.startsWith('sand');
        const isHorn = pkg.startsWith('horn');
        const is12m = pkg.endsWith('12');
        const is15m = pkg.endsWith('15');
        
        let shouldShow = false;
        if ((currentNozzleType === "four" && isFour) || 
            (currentNozzleType === "sand" && isSand) || 
            (currentNozzleType === "horn" && isHorn) ||
            currentNozzleType === "custom") {
            shouldShow = (currentNozzleSize === "1.2" && is12m) || (currentNozzleSize === "1.5" && is15m) || currentNozzleType === "custom";
        }
        
        pkgRow.style.display = shouldShow ? 'table-row' : 'none';
        pkgItems.forEach(item => item.style.display = shouldShow ? (item.style.display || 'none') : 'none');
        pkgQtyInput.disabled = !isEdit;
    });
}

function to5or10(num) {
    let ceilNum = Math.ceil(num);
    return ceilNum <= 5 ? 5 : Math.ceil(ceilNum / 10) * 10;
}

function calc25Dutou(baseNum) {
    if (baseNum < 5) return baseNum;
    let div = baseNum / 5, y = Math.floor(div), tail = div - y;
    return baseNum + (tail >= 0.5 ? y + 1 : y);
}

function calc3Dutou(wid, colNum) {
    return colNum < 2 ? 0 : 1 + Math.floor(wid / 65);
}

function calcNozzleLayout(X, nozzleGap) {
    const isSymmetry = X > SYMMETRY_THRESHOLD;
    const halfX = isSymmetry ? X / 2 : X;
    const division = halfX / nozzleGap;
    const divisionFixed = division.toFixed(3);
    const y = Math.floor(division);
    const tailRaw = division - y;
    
    let oddNum, evenNum;
    if (tailRaw === 0) {
        oddNum = y || 1;
        evenNum = (y + 1) || 1;
    } else if (tailRaw > 0 && tailRaw <= 0.5) {
        oddNum = y + 1;
        evenNum = y + 1;
    } else if (tailRaw > 0.5 && tailRaw < 1) {
        oddNum = y + 1;
        evenNum = y + 2;
    } else {
        oddNum = y || 1;
        evenNum = (y + 1) || 1;
    }
    const calcStr = isSymmetry 
        ? `${X}Ã·2Ã·${nozzleGap}=${divisionFixed} | å•†=${y} | å°¾æ•°=${tailRaw.toFixed(3)}` 
        : `${X}Ã·${nozzleGap}=${divisionFixed} | å•†=${y} | å°¾æ•°=${tailRaw.toFixed(3)}`;
    return { isSymmetry, halfX, tail: tailRaw, y, odd: { num: oddNum }, even: { num: evenNum }, calcStr };
}

function calcWidthLayout(widthVal, colGapVal) {
    const division = widthVal / colGapVal;
    const divisionFixed = division.toFixed(3);
    const y = Math.floor(division);
    const tail = (division - y).toFixed(3);
    const calcStr = `${widthVal}Ã·${colGapVal}=${divisionFixed} | å•†=${y} | å°¾æ•°=${tail}`;
    return { calcStr, divisionFixed, y, tail: division - y };
}

function calcPipeNum(widthVal, colGapVal) {
    let div = widthVal / colGapVal;
    return div === Math.floor(div) ? div : Math.floor(div) + 1 || 1;
}

function calcShortBranch(tail, pipeNum, evenColNum, isSplit) {
    let num = 0;
    if (tail === 0) num = pipeNum + evenColNum * 2;
    else if (tail > 0 && tail <= 0.5) num = pipeNum * 2;
    else if (tail > 0.5 && tail < 1) num = pipeNum + evenColNum * 2;
    num = Math.max(num, 1);
    return isSplit ? num * 2 : num;
}

function toggleThreeFourWay(isSplit) {
    if (isSplit) {
        el.threeWayTr.style.display = 'none';
        el.fourWayTr.style.display = 'table-row';
    } else {
        el.threeWayTr.style.display = 'table-row';
        el.fourWayTr.style.display = 'none';
    }
    if (hasQtyItemIds.includes('threeWayTr')) el.threeWayTr.style.display = 'table-row !important';
    if (hasQtyItemIds.includes('fourWayTr')) el.fourWayTr.style.display = 'table-row !important';
}

function chooseNozzleSize(size) {
    currentNozzleSize = size;
    if (size === "1.2") {
        el.gun12Switch.classList.add('active');
        el.gun15Switch.classList.remove('active');
    } else {
        el.gun12Switch.classList.remove('active');
        el.gun15Switch.classList.add('active');
    }
    updatePackageDisplay();
    if (el.result.style.display === "block") calcTotal(true);
}

function toggleHistory() {
    el.historyPanel.classList.toggle('show');
    if (el.historyPanel.classList.contains('show')) renderHistoryList();
}

function saveHistory(num1, num2, totalPrice) {
    const now = new Date();
    const timeStr = `${now.getMonth() + 1}-${now.getDate()} ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
    const sortedNum1 = Math.max(num1, num2);
    const sortedNum2 = Math.min(num1, num2);
    const nozzleDesc = `${currentNozzleSize}ç±³${currentNozzleType === "four" ? "å››å˜´" : currentNozzleType === "sand" ? "é˜²æ²™" : currentNozzleType === "horn" ? "ç¾Šè§’" : "è‡ªå®šä¹‰"}å–·å¤´`;
    const item = { num1: sortedNum1, num2: sortedNum2, totalPrice, timeStr, nozzleDesc };
    
    const idx = historyList.findIndex(i => i.num1 === sortedNum1 && i.num2 === sortedNum2 && i.nozzleDesc === nozzleDesc);
    if (idx > -1) {
        historyList[idx].totalPrice = totalPrice;
        historyList[idx].timeStr = timeStr;
    } else {
        historyList.unshift(item);
        if (historyList.length > 5) historyList.pop();
    }
    
    localStorage.setItem('calcHistory', JSON.stringify(historyList));
    if (el.historyPanel.classList.contains('show')) renderHistoryList();
}

function renderHistoryList() {
    if (historyList.length === 0) {
        el.historyPanel.innerHTML = '<div class="history-item">æš‚æ— å†å²è®°å½•</div>';
        return;
    }
    
    let html = '';
    historyList.forEach((item, idx) => {
        html += `<div class="history-item" data-index="${idx}">
            <span>${item.num1}Ã—${item.num2}m</span>
            <span>|</span>
            <span>${item.nozzleDesc}</span>
            <span>|</span>
            <span>æ€»ä»·${item.totalPrice}</span>
            <div class="history-time">${item.timeStr}</div>
        </div>`;
    });
    el.historyPanel.innerHTML = html;
    
    document.querySelectorAll('.history-item').forEach(item => {
        item.addEventListener('click', () => loadHistory(item.dataset.index));
    });
}

function loadHistory(idx) {
    const item = historyList[idx];
    el.plotLength.value = item.num1;
    el.plotWidth.value = item.num2;
    
    if (item.nozzleDesc.includes('ç¾Šè§’')) el.nozzleType.value = 'horn';
    else if (item.nozzleDesc.includes('å››å˜´')) el.nozzleType.value = 'four';
    else if (item.nozzleDesc.includes('é˜²æ²™')) el.nozzleType.value = 'sand';
    else el.nozzleType.value = 'custom';
    handleNozzleTypeChange();
    
    chooseNozzleSize(item.nozzleDesc.includes('1.2') ? '1.2' : '1.5');
    
    calc();
    toggleHistory();
}

function showClearModal() {
    historyList = JSON.parse(localStorage.getItem('calcHistory')) || [];
    if (historyList.length === 0) {
        alert('æ— è®°å½•å¯æ¸…');
        return;
    }
    el.clearModal.style.display = 'flex';
}

function hideClearModal() {
    el.clearModal.style.display = 'none';
}

function confirmClear() {
    historyList = [];
    localStorage.removeItem('calcHistory');
    if (el.historyPanel.classList.contains('show')) renderHistoryList();
    hideClearModal();
    alert('è®°å½•å·²æ¸…ç©º');
}

const CONFIG_KEY = "sprinklerAppConfig";
const configFields = {
    plotLength: { type: "input", selector: "#plotLength" },
    plotWidth: { type: "input", selector: "#plotWidth" },
    nozzleType: { type: "select", selector: "#nozzleType" },
    gun12Switch: { type: "switch", selector: "#gun12Switch" },
    gun15Switch: { type: "switch", selector: "#gun15Switch" },
    nozzleDiameter: { type: "input", selector: "#nozzleDiameter" },
    colGap: { type: "input", selector: "#colGap" },
    discountAmount: { type: "input", selector: "#discountAmount" }
};

function saveConfig() {
    const config = {};
    Object.keys(configFields).forEach(key => {
        const field = configFields[key];
        const element = document.querySelector(field.selector);
        if (!element) return;
        if (field.type === "input") config[key] = element.value;
        else if (field.type === "select") config[key] = element.value;
        else if (field.type === "switch") config[key] = element.classList.contains("active");
    });
    config.hasCalculated = el.result.style.display === "block";
    localStorage.setItem(CONFIG_KEY, JSON.stringify(config));
}

function loadConfig() {
    const savedConfig = localStorage.getItem(CONFIG_KEY);
    if (savedConfig) {
        const config = JSON.parse(savedConfig);
        Object.keys(configFields).forEach(key => {
            const field = configFields[key];
            const element = document.querySelector(field.selector);
            if (!element || config[key] === undefined) return;
            if (field.type === "input") element.value = config[key];
            else if (field.type === "select") {
                element.value = config[key];
                handleNozzleTypeChange();
            } else if (field.type === "switch") {
                if (key === "gun12Switch" && config[key]) chooseNozzleSize("1.2");
                if (key === "gun15Switch" && config[key]) chooseNozzleSize("1.5");
            }
        });
        if (config.hasCalculated && config.plotLength && config.plotWidth) {
            setTimeout(calc, 300);
        }
    } else {
        document.getElementById('plotLength').value = "200";
        document.getElementById('plotWidth').value = "48";
        document.getElementById('nozzleDiameter').value = "16";
        document.getElementById('colGap').value = "16";
        el.nozzleType.value = "four";
        chooseNozzleSize("1.2");
    }
}

function initConfigPersistence() {
    window.addEventListener("load", loadConfig);
    Object.keys(configFields).forEach(key => {
        const field = configFields[key];
        const element = document.querySelector(field.selector);
        if (!element) return;
        if (field.type === "input" || field.type === "select") {
            element.addEventListener("input", saveConfig);
            element.addEventListener("change", saveConfig);
        } else if (field.type === "switch") {
            element.addEventListener("click", saveConfig);
        }
    });
    el.calcBtn.addEventListener("click", function() {
        el.result.style.display = "block";
        saveConfig();
    });
}

function initEnterGenerateOnlyInSizeInputs() {
    const lengthInput = document.getElementById('plotLength');
    const widthInput = document.getElementById('plotWidth');
    const calcBtn = document.getElementById('calcBtn');
    [lengthInput, widthInput].forEach(input => {
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                calcBtn.click();
            }
        });
    });
    document.addEventListener('keydown', function(e) {
        const activeElement = document.activeElement;
        if (e.key === 'Enter' && activeElement !== lengthInput && activeElement !== widthInput) {
            e.preventDefault();
        }
    }, { capture: true });
}

function applyDiscount() {
    const targetFinalPrice = parseFloat(el.discountAmount.value) || 0;
    const originalTotal = parseFloat(el.originalTotal.innerText) || 0;
    const originalTotalTr = document.getElementById('originalTotalTr');
    const discountTotalTr = document.getElementById('discountTotalTr');
    const finalTotalTr = document.getElementById('finalTotalTr');
    
    let currentDiscount = originalTotal - targetFinalPrice;
    
    if (targetFinalPrice <= 0 || currentDiscount <= 0) {
        currentDiscount = 0;
        originalTotalTr.style.display = 'none';
        discountTotalTr.style.display = 'none';
        finalTotalTr.querySelector('td:first-child').innerText = 'æ€»ä»·';
        el.finalTotal.innerText = originalTotal.toFixed(1);
    } else if (targetFinalPrice > originalTotal) {
        alert(`ä¼˜æƒ åé‡‘é¢ä¸èƒ½è¶…è¿‡åŸæ€»ä»·ï¼ˆ${originalTotal}å…ƒï¼‰`);
        el.discountAmount.value = originalTotal;
        currentDiscount = 0;
        originalTotalTr.style.display = 'none';
        discountTotalTr.style.display = 'none';
        finalTotalTr.querySelector('td:first-child').innerText = 'æ€»ä»·';
        el.finalTotal.innerText = originalTotal.toFixed(1);
    } else {
        originalTotalTr.style.display = 'table-row';
        discountTotalTr.style.display = 'table-row';
        finalTotalTr.querySelector('td:first-child').innerText = 'æœ€ç»ˆåº”ä»˜é‡‘é¢';
        el.finalTotal.innerText = targetFinalPrice.toFixed(1);
    }
    
    el.discountTotal.innerText = `-${currentDiscount.toFixed(1)}`;
    document.getElementById('showOriginalTotal').innerText = originalTotal.toFixed(1);
    document.getElementById('showAutoDiscount').innerText = currentDiscount.toFixed(1);
    
    if (el.result.style.display === "block") {
        const X = Number(el.plotLength.value);
        const widthVal = Number(el.plotWidth.value);
        const finalTotal = el.finalTotal.innerText;
        saveHistory(X, widthVal, finalTotal + "å…ƒ");
    }
}

function calcTotal(isApplyDiscount = true) {
    let total = 0;
    document.querySelectorAll('[id^="s_"]').forEach(el => {
        if (!['originalTotal', 'discountTotal', 'finalTotal'].includes(el.id)) {
            el.innerText = '0.0';
        }
    });
    
    const packageRows = document.querySelectorAll('.package-row');
    packageRows.forEach(row => {
        const pkgId = row.dataset.package;
        const qty = parseFloat(document.getElementById(`q_${pkgId}`).value) || 0;
        const price = parseFloat(row.querySelector('td:nth-child(4)').innerText) || 0;
        const subtotal = (qty * price).toFixed(1);
        document.getElementById(`s_${pkgId}`).innerText = subtotal;
        total += parseFloat(subtotal);
    });
    
    const packageItems = document.querySelectorAll('.package-item');
    packageItems.forEach(item => {
        const pkgId = item.dataset.package;
        const pkgQty = parseFloat(document.getElementById(`q_${pkgId}`).value) || 0;
        const itemQty = parseFloat(item.querySelector('.package-item-qty').value) || 0;
        const itemPrice = parseFloat(item.querySelector('.package-price').value) || 0;
        const extraQty = Math.max(0, itemQty - pkgQty);
        const subtotal = (extraQty * itemPrice).toFixed(1);
        const sId = item.querySelector('td:last-child').id;
        document.getElementById(sId).innerText = subtotal;
        total += parseFloat(subtotal);
    });
    
    document.querySelectorAll('.qty-input:not(.package-qty):not(.package-item-qty)').forEach(input => {
        const qtyId = input.id;
        const sId = qtyId.replace('q', 's');
        const sEl = document.getElementById(sId);
        if (!sEl) return;
        let unitPrice = 0;
        if (PRICE_MAP.common[qtyId]) {
            unitPrice = PRICE_MAP.common[qtyId];
        } else {
            const priceCell = input.closest('tr').querySelector('td:nth-child(4)');
            unitPrice = parseFloat(priceCell.innerText) || 0;
        }
        const qty = parseFloat(input.value) || 0;
        const subtotal = (qty * unitPrice).toFixed(1);
        sEl.innerText = subtotal;
        total += parseFloat(subtotal);
    });
    
    // è‡ªå®šä¹‰é…ä»¶é‡‘é¢è®¡ç®—
    document.querySelectorAll('.custom-dynamic').forEach(row => {
        const price = parseFloat(row.dataset.price) || 0;
        const qty = parseFloat(row.dataset.qty) || 0;
        const amount = price * qty;
        total += amount;
        row.querySelector('.custom-amount').innerText = amount.toFixed(2);
    });
    
    const originalTotalStr = total.toFixed(1);
    el.originalTotal.innerText = originalTotalStr;
    document.getElementById('showOriginalTotal').innerText = originalTotalStr;
    if (isApplyDiscount) {
        applyDiscount();
    } else {
        el.discountTotal.innerText = `-${currentDiscount.toFixed(1)}`;
        const finalTotal = (parseFloat(originalTotalStr) - currentDiscount).toFixed(1);
        el.finalTotal.innerText = finalTotal;
    }
    return el.finalTotal.innerText;
}

function calc() {
    const X = Number(el.plotLength.value);
    const widthVal = Number(el.plotWidth.value);
    const colGapVal = Number(el.colGap.value);
    const nozzleGapVal = Number(el.nozzleDiameter.value);
    
    if (!X || !widthVal || !colGapVal || !nozzleGapVal || X <=0 || widthVal <=0 || colGapVal <=0 || nozzleGapVal <=0) {
        alert('è¯·å¡«å†™æœ‰æ•ˆçš„æ­£æ•°å€¼');
        return;
    }
    
    const nozzleLayout = calcNozzleLayout(X, nozzleGapVal);
    const widthLayout = calcWidthLayout(widthVal, colGapVal);
    const pipeNum = calcPipeNum(widthVal, colGapVal);
    const isSplit = nozzleLayout.isSymmetry;
    const oddColNum = Math.ceil(pipeNum / 2);
    const evenColNum = Math.floor(pipeNum / 2);
    const finalOddNum = isSplit ? nozzleLayout.odd.num * 2 : nozzleLayout.odd.num;
    const finalEvenNum = isSplit ? nozzleLayout.even.num * 2 : nozzleLayout.even.num;
    const totalNozzle = Math.max(0, (oddColNum * finalOddNum) + (evenColNum * finalEvenNum));
    
    document.querySelectorAll('.qty-input').forEach(input => input.value = 0);
    
    const currentPackageId = `${currentNozzleType}${currentNozzleSize.replace('.', '')}`;
    const currentPackageQtyInput = document.getElementById(`q_${currentPackageId}`);
    if (currentPackageQtyInput) {
        currentPackageQtyInput.value = totalNozzle;
        updatePackageItems(currentPackageId, totalNozzle);
    }
    
    const mat = {
        q4: to5or10(totalNozzle / 3),
        q5: calc25Dutou(isSplit ? pipeNum * 2 : pipeNum),
        q6: Math.max(0, (pipeNum >= 2 && !isSplit) ? pipeNum : 0),
        q7: Math.max(0, (pipeNum >= 2 && isSplit) ? pipeNum : 0),
        q9: calc3Dutou(widthVal, pipeNum),
        q10: to5or10(totalNozzle * 0.1) * 4,
        q11: to5or10(totalNozzle * 0.1),
        q12: to5or10(totalNozzle * 0.1) * 2,
        q35: to5or10(pipeNum * 0.2),
        q36: to5or10(pipeNum * 0.2),
        q37: to5or10(totalNozzle * 0.1) * 2,
        q13:0, q14:0, q15:0, q16:0, q17:0, q21:0, q22:0, q23:0, q24:0, q25:0, q26:0,
        q2:0, q3:0, q8:0, q_s5:0, q_s10:0, q_s3:0, q30:0, q31:0, q32:0, q33:0, q34:0
    };
    
    if (currentNozzleType === "four" || currentNozzleType === "horn") {
        mat.q2 = calcShortBranch(nozzleLayout.tail, pipeNum, evenColNum, isSplit);
        mat.q3 = Math.max(0, totalNozzle - mat.q2);
        mat.q8 = Math.max(0, pipeNum >= 2 ? pipeNum : 0);
    } else if (currentNozzleType === "sand") {
        mat.q_s5 = calcShortBranch(nozzleLayout.tail, pipeNum, evenColNum, isSplit);
        mat.q_s10 = Math.max(0, totalNozzle - mat.q_s5);
        mat.q_s3 = Math.max(0, pipeNum >= 2 ? pipeNum : 0);
    }
    
    Object.keys(mat).forEach(key => {
        if (key === 'q4_new' || key === 'q18') return;
        const inputEl = document.getElementById(key);
        if (inputEl) inputEl.value = mat[key];
    });
    
    toggleThreeFourWay(isSplit);
    resetAllItemsDisplay();
    updatePackageDisplay();
    
    el.param.innerHTML = `
        <p>âœ… åˆ†å—ï¼š${isSplit ? `æ˜¯(2å—ï¼Œå•å—${(X/2).toFixed(1)}m)` : 'å¦'}</p>
        <p>âœ… é•¿åº¦æ ¸ç®—ï¼š${nozzleLayout.calcStr}</p>
        <p>âœ… å®½åº¦æ ¸ç®—ï¼š${widthLayout.calcStr}</p>
        <p>âœ… åˆ—æ•°ï¼šå…±${pipeNum}åˆ—(å¥‡${oddColNum}/å¶${evenColNum})</p>
        <p>âœ… æ¯åˆ—å–·å¤´æ•°ï¼šå¥‡${finalOddNum}æ”¯ å¶${finalEvenNum}æ”¯ | æ€»å–·å¤´æ•°${totalNozzle}æ”¯</p>
    `;
    
    el.result.style.display = "block";
    el.result.scrollIntoView({ behavior: "smooth" });
    const totalPrice = calcTotal();
    saveHistory(X, widthVal, totalPrice);
}

// æµ®çª—ç›¸å…³åŠŸèƒ½
function initPartsModal() {
    el.openPartsModalBtn.addEventListener('click', function() {
        el.partsModalMask.style.display = 'flex';
    });
    
    el.partsModalClose.addEventListener('click', function() {
        el.partsModalMask.style.display = 'none';
    });
    
    el.partsModalMask.addEventListener('click', function(e) {
        if (e.target === el.partsModalMask) {
            el.partsModalMask.style.display = 'none';
        }
    });
    
    // åŸæœ‰çš„é…ä»¶æ·»åŠ æŒ‰é’®
    document.querySelectorAll('.parts-item-add:not(.add-custom-btn)').forEach(btn => {
        btn.addEventListener('click', function() {
            const partStr = this.getAttribute('data-part');
            const part = JSON.parse(partStr);
            addCustomPart(part);
        });
    });
    
    // æ–°å¢ï¼šæµ®çª—è¡¨æ ¼çš„äº¤äº’åŠŸèƒ½
    setTimeout(() => {
        // è§„æ ¼æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.spec-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const specValue = this.dataset.spec;
                const specInput = document.querySelector('.custom-spec-input');
                const allBtns = document.querySelectorAll('.spec-btn');
                
                // é‡ç½®æ‰€æœ‰æŒ‰é’®æ ·å¼
                allBtns.forEach(b => {
                    b.style.background = '#f5f5f5';
                    b.style.color = '#333';
                });
                
                // è®¾ç½®é€‰ä¸­æŒ‰é’®æ ·å¼
                this.style.background = '#3498db';
                this.style.color = 'white';
                
                if (specValue === 'å…¶ä»–') {
                    specInput.style.display = 'block';
                    specInput.focus();
                } else {
                    specInput.style.display = 'none';
                    specInput.value = specValue;
                }
            });
        });
        
        // æ·»åŠ æŒ‰é’®äº‹ä»¶
        const addBtn = document.querySelector('.add-custom-btn');
        if (addBtn) {
            addBtn.addEventListener('click', addCustomFromTable);
        }
        
        // Enteré”®æ·»åŠ 
        document.querySelectorAll('.custom-name, .custom-price, .custom-qty').forEach(input => {
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    addCustomFromTable();
                }
            });
        });
    }, 100);
}

// ç›´æ¥å¼¹çª—è¾“å…¥ï¼Œä¸ç”¨æ‰¾è¾“å…¥æ¡†ï¼Œé¿å…é€‰æ‹©å™¨é—®é¢˜
function addCustomFromTable() {
    // ç›´æ¥è¯»å–è¡¨æ ¼å†…è¾“å…¥æ¡†çš„å€¼ï¼ˆidå’Œè¾“å…¥æ¡†å®Œå…¨å¯¹åº”ï¼‰
    const category = document.getElementById('custom-category').value;
    const name = document.getElementById('custom-name').value.trim();
    const specInput = document.querySelector('.custom-spec-input');
    const price = parseFloat(document.getElementById('custom-price').value) || 0;
    const qty = parseInt(document.getElementById('custom-qty').value) || 1;
    
    // è¯»å–é€‰ä¸­çš„è§„æ ¼ï¼ˆæŒ‰é’®æˆ–è‡ªå®šä¹‰è¾“å…¥ï¼‰
    let spec = specInput.value.trim();
    if (!spec) {
        const activeBtn = document.querySelector('.spec-btn[style*="background: #3498db"]');
        spec = activeBtn ? activeBtn.dataset.spec : 'ä¸ª';
    }
    
    // éªŒè¯å¿…å¡«é¡¹
    if (!name) {
        alert('è¯·å¡«å†™é…ä»¶åç§°');
        document.getElementById('custom-name').focus();
        return;
    }
    if (price < 0) {
        alert('å•ä»·ä¸èƒ½ä¸ºè´Ÿæ•°');
        document.getElementById('custom-price').focus();
        return;
    }
    
    // æ·»åŠ é…ä»¶
    const part = { name, spec, price, category };
    addCustomPart(part, qty);
    
    // æ¸…ç©ºè¾“å…¥æ¡†ï¼Œæ–¹ä¾¿ç»§ç»­æ·»åŠ 
    document.getElementById('custom-name').value = '';
    document.getElementById('custom-price').value = '';
    document.getElementById('custom-qty').value = '1';
    specInput.value = '';
    specInput.style.display = 'none';
    document.querySelectorAll('.spec-btn').forEach(btn => {
        btn.style.background = '#f5f5f5';
        btn.style.color = '#333';
    });
    document.getElementById('custom-name').focus();
}


// ä¿®æ”¹ç°æœ‰çš„addCustomPartå‡½æ•°ï¼Œæ·»åŠ åˆ†ç±»æ”¯æŒ
function addCustomPart(part, qty = 1) {
    const itemId = `custom_${customItemIndex}`;
    const newRow = document.createElement('tr');
    newRow.className = 'custom-item custom-dynamic';
    newRow.id = itemId;
    newRow.dataset.name = part.name;
    newRow.dataset.spec = part.spec;
    newRow.dataset.price = part.price || 0;
    newRow.dataset.qty = qty;
    newRow.dataset.category = part.category || 'é€‰é…ä»¶';
    
    const category = part.category || 'é€‰é…ä»¶';
    const price = part.price || 0;
    
    // å…³é”®ä¿®æ”¹ï¼šç»Ÿä¸€å±…ä¸­+æ•°é‡æ¡†æ ·å¼+åˆè®¡é¢œè‰²
    newRow.innerHTML = `
        <td style="text-align: center; font-size: 12px; color: ${category === 'èµ é€ä»¶' ? '#27ae60' : '#333'};" class="custom-label">${category}</td>
        <td style="padding: 4px; text-align: center;" class="custom-name">${part.name}</td>
        <td style="padding: 4px; text-align: center;" class="custom-spec">${part.spec}</td>
        <td style="padding: 4px; text-align: center;" class="custom-price">${price}</td>
        <td style="padding: 4px; text-align: center;">
            <input type="number" class="qty-input custom-qty" value="${qty}" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;" ${isQtyLocked ? 'disabled' : ''}>
        </td>
        <td style="font-size: 12px; text-align: center; padding: 4px; color: #333;" class="custom-amount">${(price * qty).toFixed(1)}</td>
    `;

    // å·¦æ»‘åˆ é™¤
    let startX = 0;
    let isSwiping = false;
    newRow.style.transition = 'transform 0.2s ease-out';
    newRow.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        isSwiping = true;
    });
    newRow.addEventListener('touchmove', (e) => {
        if (!isSwiping) return;
        const diffX = startX - e.touches[0].clientX;
        if (diffX > 0 && diffX <= 30) newRow.style.transform = `translateX(-${diffX}px)`;
    });
    newRow.addEventListener('touchend', (e) => {
        isSwiping = false;
        const diffX = startX - e.changedTouches[0].clientX;
        newRow.style.transform = 'translateX(0)';
        if (diffX > 20 && confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªç‰©æ–™å—ï¼Ÿ')) {
            newRow.remove();
            calcTotal();
        }
    });

    // é•¿æŒ‰ä¿®æ”¹å•ä¸ªå­—æ®µï¼ˆæŒ‰å“ªä¸ªæ”¹å“ªä¸ªï¼‰
    const cells = newRow.querySelectorAll('td');
    cells.forEach((cell, index) => {
        if (index === 4) return; // è·³è¿‡æ•°é‡åˆ—
        if (index === 5) return; // è·³è¿‡é‡‘é¢åˆ—
        
        cell.addEventListener('touchstart', function(e) {
            const timer = setTimeout(() => {
                let newValue;
                const currentValue = this.innerText;
                
                switch(index) {
                    case 0: // åˆ†ç±»
                        newValue = prompt("ä¿®æ”¹åˆ†ç±»ï¼ˆé€‰é…ä»¶/èµ é€ä»¶ï¼‰ï¼š", currentValue);
                        if (newValue === 'é€‰é…ä»¶' || newValue === 'èµ é€ä»¶') {
                            newRow.dataset.category = newValue;
                            this.innerText = newValue;
                            this.style.color = newValue === 'èµ é€ä»¶' ? '#27ae60' : '#333';
                        }
                        break;
                    case 1: // åç§°
                        newValue = prompt("ä¿®æ”¹é…ä»¶åç§°ï¼š", currentValue);
                        if (newValue) {
                            newRow.dataset.name = newValue;
                            this.innerText = newValue;
                        }
                        break;
                    case 2: // è§„æ ¼
                        newValue = prompt("ä¿®æ”¹è§„æ ¼ï¼š", currentValue);
                        if (newValue) {
                            newRow.dataset.spec = newValue;
                            this.innerText = newValue;
                        }
                        break;
                    case 3: // å•ä»·
                        newValue = prompt("ä¿®æ”¹å•ä»·ï¼ˆå…ƒï¼‰ï¼š", currentValue);
                        if (!isNaN(newValue) && newValue >= 0) {
                            newRow.dataset.price = newValue;
                            this.innerText = parseFloat(newValue).toFixed(1);
                            // æ›´æ–°é‡‘é¢
                            updateCustomAmount(newRow);
                        }
                        break;
                }
            }, 500);
            
            // æ¸…é™¤å®šæ—¶å™¨
            const clearTimer = () => {
                clearTimeout(timer);
                cell.removeEventListener('touchend', clearTimer);
                cell.removeEventListener('touchmove', clearTimer);
            };
            
            cell.addEventListener('touchend', clearTimer);
            cell.addEventListener('touchmove', clearTimer);
        });
    });

    // æ•°é‡ä¿®æ”¹åŒæ­¥é‡‘é¢
    newRow.querySelector('.custom-qty').addEventListener('input', function() {
        const qty = Number(this.value) || 0;
        newRow.dataset.qty = qty;
        updateCustomAmount(newRow);
    });

    el.customItemsContainer.appendChild(newRow);
    newRow.style.display = 'table-row';
    customItemIndex++;
    calcTotal();
    
    // å…³é—­æµ®çª—
    el.partsModalMask.style.display = 'none';
}

// æ›´æ–°è‡ªå®šä¹‰é…ä»¶é‡‘é¢
function updateCustomAmount(row) {
    const price = parseFloat(row.dataset.price) || 0;
    const qty = parseFloat(row.dataset.qty) || 0;
    const amount = price * qty;
    // ç¡®ä¿é‡‘é¢æ ¼å¼ä¸æ­£å¸¸ä»¶ä¸€è‡´ï¼ˆ0æ˜¾ç¤º0.0ï¼Œé0ä¿ç•™1ä½å°æ•°ï¼‰
    const amountStr = amount === 0 ? '0.0' : amount.toFixed(1);
    row.querySelector('.custom-amount').innerText = amountStr;
    calcTotal();
}



// è‡ªå®šä¹‰é…ä»¶ï¼šæ·»åŠ æ—¶å¼¹çª—è¾“å…¥+è¡¨æ ¼æ— æ¡†+é•¿æŒ‰ä¿®æ”¹
function addBlankCustomPart() {
    // 1. æ·»åŠ æ—¶å¼¹çª—è¾“å…¥å‚æ•°
    const name = prompt("è¯·è¾“å…¥é…ä»¶åç§°ï¼š", "");
    if (!name) return; // å–æ¶ˆè¾“å…¥åˆ™é€€å‡º
    const spec = prompt("è¯·è¾“å…¥è§„æ ¼å•ä½ï¼ˆå¦‚ä¸ª/å¥—ï¼‰ï¼š", "");
    if (!spec) return;
    const price = prompt("è¯·è¾“å…¥å•ä»·ï¼ˆå…ƒï¼‰ï¼š", "0");
    if (isNaN(price) || price < 0) {
        alert("å•ä»·å¿…é¡»æ˜¯éè´Ÿæ•°å­—");
        return;
    }
    const qty = prompt("è¯·è¾“å…¥æ•°é‡ï¼š", "1");
    if (isNaN(qty) || qty < 0) {
        alert("æ•°é‡å¿…é¡»æ˜¯æ­£æ•´æ•°");
        return;
    }
    
    // 2. åˆ›å»ºè¡¨æ ¼è¡Œï¼ˆå…³é”®ï¼šæ·»åŠ  newRow å®šä¹‰ï¼‰
    const itemId = `custom_${customItemIndex}`;
    const newRow = document.createElement('tr');
    newRow.className = 'custom-item custom-dynamic';
    newRow.id = itemId;
    newRow.dataset.name = name;
    newRow.dataset.spec = spec;
    newRow.dataset.price = price;
    newRow.dataset.qty = qty;
    
    // è¡¨æ ¼å†…å®¹ï¼ˆçº¯æ–‡æœ¬æ˜¾ç¤ºï¼‰
    newRow.innerHTML = `
         <td style="text-align: center; font-size: 12px; color: #333;" class="custom-label">${price == 0 ? 'èµ é€ä»¶' : 'é€‰é…ä»¶'}</td>
         <td style="padding: 4px; text-align: center;" class="custom-name">${name}</td>
         <td style="padding: 4px; text-align: center;" class="custom-spec">${spec}</td>
         <td style="padding: 4px; text-align: center;" class="custom-price">${price}</td>
         <td style="padding: 4px; text-align: center;">
             <input type="number" class="qty-input custom-qty" value="${qty}" min="0" style="width: 50px; padding: 2px; font-size: 12px; text-align: center; box-sizing: border-box;" ${isQtyLocked ? 'disabled' : ''}>
         </td>
         <td style="font-size: 12px; text-align: center; padding: 4px; color: #333;" class="custom-amount">${(price * qty).toFixed(1)}</td>
     `;
    
    // 3. å·¦æ»‘åˆ é™¤
    let startX = 0;
    let isSwiping = false;
    newRow.style.transition = 'transform 0.2s ease-out';
    newRow.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        isSwiping = true;
    });
    newRow.addEventListener('touchmove', (e) => {
        if (!isSwiping) return;
        const diffX = startX - e.touches[0].clientX;
        if (diffX > 0 && diffX <= 30) newRow.style.transform = `translateX(-${diffX}px)`;
    });
    newRow.addEventListener('touchend', (e) => {
        isSwiping = false;
        const diffX = startX - e.changedTouches[0].clientX;
        newRow.style.transform = 'translateX(0)';
        if (diffX > 20 && confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªç‰©æ–™å—ï¼Ÿ')) {
            newRow.remove();
            calcTotal();
        }
    });
    
    // 4. é•¿æŒ‰ä¿®æ”¹ï¼ˆé‡æ–°å¼¹çª—è¾“å…¥ï¼‰
    newRow.addEventListener('touchstart', () => {
        let longPressTimer = setTimeout(() => {
            const newName = prompt("ä¿®æ”¹é…ä»¶åç§°ï¼š", newRow.dataset.name);
            if (newName) {
                newRow.dataset.name = newName;
                newRow.querySelector('.custom-name').innerText = newName;
            }
            const newSpec = prompt("ä¿®æ”¹è§„æ ¼å•ä½ï¼š", newRow.dataset.spec);
            if (newSpec) {
                newRow.dataset.spec = newSpec;
                newRow.querySelector('.custom-spec').innerText = newSpec;
            }
            const newPrice = prompt("ä¿®æ”¹å•ä»·ï¼ˆå…ƒï¼‰ï¼š", newRow.dataset.price);
            if (!isNaN(newPrice) && newPrice >= 0) {
                newRow.dataset.price = newPrice;
                newRow.querySelector('.custom-price').innerText = newPrice;
                newRow.querySelector('.custom-label').innerText = newPrice == 0 ? 'èµ é€ä»¶' : 'é€‰é…ä»¶';
                newRow.querySelector('.custom-label').style.color = newPrice == 0 ? '#27ae60' : '#666';
            }
            const newQty = prompt("ä¿®æ”¹æ•°é‡ï¼š", newRow.dataset.qty);
            if (!isNaN(newQty) && newQty >= 0) {
                newRow.dataset.qty = newQty;
                newRow.querySelector('.custom-qty').value = newQty;
            }
            // æ›´æ–°é‡‘é¢
            const finalPrice = Number(newRow.dataset.price);
            const finalQty = Number(newRow.dataset.qty);
            newRow.querySelector('.custom-amount').innerText = (finalPrice * finalQty).toFixed(1);
            calcTotal();
        }, 500);
        
        // å–æ¶ˆé•¿æŒ‰
        newRow.addEventListener('touchend', () => clearTimeout(longPressTimer));
        newRow.addEventListener('touchmove', () => clearTimeout(longPressTimer));
    });
    
    // 5. æ•°é‡ä¿®æ”¹åŒæ­¥é‡‘é¢
    newRow.querySelector('.custom-qty').addEventListener('input', function() {
        const qty = Number(this.value) || 0;
        newRow.dataset.qty = qty;
        const price = Number(newRow.dataset.price) || 0;
        newRow.querySelector('.custom-amount').innerText = (price * qty).toFixed(1);
        calcTotal();
    });
    
    // 6. æ·»åŠ åˆ°è¡¨æ ¼
    el.customItemsContainer.appendChild(newRow);
    newRow.style.display = 'table-row';
    customItemIndex++;
    el.partsModalMask.style.display = 'none';
    calcTotal();
}


function bindEvents() {
    el.nozzleType.addEventListener('change', handleNozzleTypeChange);
    document.querySelectorAll('.switch-wrap[data-size]').forEach(wrap => {
        wrap.addEventListener('click', () => chooseNozzleSize(wrap.dataset.size));
    });
    
    el.toggleHistoryBtn.addEventListener('click', toggleHistory);
    el.clearHistoryBtn.addEventListener('click', showClearModal);
    el.confirmClearBtn.addEventListener('click', confirmClear);
    el.cancelClearBtn.addEventListener('click', hideClearModal);
    el.calcBtn.addEventListener('click', calc);
    el.applyDiscountBtn.addEventListener('click', applyDiscount);
    el.discountAmount.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') applyDiscount();
    });
    
    document.querySelectorAll('.qty-input, .price-input, .custom-qty').forEach(input => {
        input.addEventListener('input', function() {
            let val = this.value.replace(/[^0-9.]/g, '');
            if (val.includes('.') && val.split('.').length > 2) {
                val = val.split('.')[0] + '.' + val.split('.')[1];
            }
            if (val.length > 1 && val.startsWith('0') && !val.startsWith('0.')) {
                val = val.replace(/^0+/, '');
                if (val === '') val = '0';
            }
            this.value = val;
        });
    });
    
    el.downloadTableBtn.addEventListener('click', async function() {
        try {
            const table = document.getElementById('materialTable');
            document.querySelectorAll('.qty-input, .custom-qty').forEach(input => {
                const qty = parseFloat(input.value) || 0;
                if (qty > 0) {
                    let row = input.closest('tr');
                    while (row && row.tagName === 'TR') {
                        row.style.display = 'table-row !important';
                        row = row.previousElementSibling;
                    }
                }
            });
            const canvas = await html2canvas(table, {
                scale: 3,
                useCORS: true,
                backgroundColor: '#ffffff'
            });
            canvas.toBlob(blob => {
                const fileName = `DCIM/çŒæº‰ç‰©æ–™æ¸…å•_${new Date().getTime()}.png`;
                saveAs(blob, fileName);
            });
        } catch (err) {}
    });
    
    initPartsModal();
}

window.onload = function() {
    bindEvents();
    el.nozzleDiameter.disabled = true;
    el.colGap.disabled = true;
    resetAllItemsDisplay();
    updatePackageDisplay();
    if (el.historyPanel.classList.contains('show')) renderHistoryList();
    initConfigPersistence();
    initEnterGenerateOnlyInSizeInputs();
    
    document.getElementById('originalTotalTr').style.display = 'none';
    document.getElementById('discountTotalTr').style.display = 'none';
    document.getElementById('finalTotalTr').querySelector('td:first-child').innerText = 'æ€»ä»·';
    toggleQtyLock();
};
    </script>
</body>
</html>
